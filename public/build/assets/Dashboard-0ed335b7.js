import{r as l,j as e,a as U}from"./app-e8231efd.js";import{A as k}from"./ApplicationLogo-42ad0cf1.js";import"./Dropdown-5519e22e.js";import{N as C}from"./Navbar-24e658ab.js";import{d as j}from"./index-47a41a56.js";import"./transition-b766590c.js";function $({auth:n,pendingRecords:i,tags:o,dailyMissions:g}){console.log(i);const[c,N]=l.useState(""),[d,u]=l.useState(""),[h,f]=l.useState(null),[p,S]=l.useState(null),v=async s=>{try{(await fetch(`/api/clear/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"}})).ok&&(console.log(s),alert("合格を送信しました。")),(await fetch("/api/user-skill/level-up",{method:"PUT",headers:{"Content-Type":"application/json"}})).ok?console.error("Failed to clear the record."):console.error("Failed to level up the user skill.")}catch(a){console.error("There was an error clearing the record:",a)}},b=async s=>{try{(await fetch(`/api/fail/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"}})).ok?alert("不合格を送信しました。"):console.error("Failed to set the record to fail.")}catch(a){console.error("There was an error setting the record to fail:",a)}},[m,x]=l.useState(!1),y=()=>{x(!0)},_=()=>{x(!1)};l.useEffect(()=>{m&&o.length>0&&u(o[0].id)},[m,o]);const w=async s=>{s.preventDefault();const a=new FormData;if(a.append("description",c),a.append("tag_id",d),h&&a.append("video",h),j.Inertia.post("/issues",a,{preserveState:!0,only:["tags"],onProgress:r=>console.log(r.loaded/r.total)}),await getUploadUrl(),p){await handleUploadToS3(h),console.log("Upload URL: ",p);const r=new FormData;r.append("description",c),r.append("tag_id",d),r.append("video_path",p),j.Inertia.post("/issues",r,{preserveState:!0,only:["tags"],onProgress:t=>console.log(t.loaded/t.total)})}};return e.jsxs("div",{children:[e.jsxs("div",{className:"back-color",children:[e.jsx(C,{}),e.jsx(U,{title:"Dashboard"}),e.jsx("div",{className:"dashboard-subtitle",children:e.jsx("h2",{className:"dashboard-subtitle",children:"チカラを合わせてセカイを救え！"})}),e.jsx(k,{}),e.jsx("div",{className:"toppage-quest-component",children:e.jsx("button",{className:"toppage-quest",onClick:y,children:"クエスト作成"})}),m&&e.jsx("div",{className:"overlay",children:e.jsxs("div",{className:"quest-modal over",children:[e.jsx("h2",{children:"クエスト作成"}),e.jsxs("form",{onSubmit:w,className:"issue-form",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("label",{children:["ジャンル",e.jsx("select",{value:d,onChange:s=>u(s.target.value),children:o.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))})]})}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("label",{children:["動画",e.jsx("input",{type:"file",onChange:s=>f(s.target.files[0])})]})}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("label",{children:["内容",e.jsx("textarea",{value:c,onChange:s=>N(s.target.value)})]})}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{className:"issue-button",type:"submit",children:"送信"})})]}),e.jsx("button",{onClick:_,className:"issue-button",children:"閉じる"})]})})]}),n.user.is_manager===1&&i.some(s=>s.user.id!==n.user.id)&&e.jsxs("div",{className:"record-container",children:[e.jsx("h2",{children:"営業ダンジョン 回答内容"}),i.map(s=>{var a;return s.user.id!==n.user.id?e.jsxs("div",{className:"record-card",children:[e.jsxs("div",{className:"record-header",children:[e.jsxs("div",{className:"record-details",children:[e.jsx("p",{className:"record-username",children:s.user.name}),e.jsxs("p",{className:"record-gymleader",children:["営業ダンジョン：",s.gym_leader.name]})]}),e.jsxs("div",{className:"record-actions",children:[e.jsx("button",{className:"btn-clear",onClick:()=>v(s.id),children:"合格"}),e.jsx("button",{className:"btn-fail",onClick:()=>b(s.id),children:"不合格"})]})]}),e.jsx("div",{className:"dashboard-question-area",children:(a=s.gym_leader.questions)==null?void 0:a.map(r=>e.jsxs("div",{className:"dashboard-question-card",children:[e.jsxs("p",{className:"dashboard-question-text",children:["Q. ",r.question_text]}),r.answers.filter(t=>t.user_id===s.user.id).map(t=>e.jsx("div",{className:"answer-card",children:e.jsxs("p",{children:["A. ",t.answer_text]})},t.id))]},r.id))})]},s.id):null})]}),e.jsxs("div",{className:"daily-mission-container",children:[e.jsx("h2",{children:"デイリーミッション"}),e.jsx("div",{className:"daily-mission-list",children:g.map(s=>e.jsxs("div",{className:"daily-mission-card",children:[e.jsx("h3",{className:"daily-mission-mark",children:"デイリーミッション"}),e.jsx("img",{className:"daily_mission_img",src:"http://localhost/storage/dailymission.png",alt:""}),e.jsx("p",{className:"mission-description",children:s.description}),e.jsxs("p",{className:"mission-progress-info",children:["進捗度: 現在",s.current_count,"/目標",s.target_count]}),e.jsx("div",{className:"progress-bar-container",children:e.jsx("div",{className:"progress-bar",style:{width:`${Math.min(s.current_count/s.target_count,1)*100}%`,backgroundColor:s.current_count>=s.target_count?"green":"orange"},children:e.jsx("span",{className:"progress-percentage",children:`${Math.round(Math.min(s.current_count/s.target_count,1)*100)}%`})})}),s.current_count>=s.target_count?e.jsx("p",{className:"mission-completed",children:"ミッション達成！"}):e.jsx("p",{className:"mission-progress",children:"もう少しで達成！"})]},s.id))})]})]})}export{$ as default};
